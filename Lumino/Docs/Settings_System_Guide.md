# Lumino 设置系统说明

## 概述

Lumino 现在具有完整的设置系统，用户可以通过主菜单"文件 -> 设置"打开设置窗口，对应用程序进行个性化配置。

## 功能特性

### 1. 设置分类

设置界面分为以下几个类别：

- **常规设置**：基本应用设置
- **语言设置**：界面语言选择
- **主题设置**：界面主题和外观
- **编辑器设置**：编辑器行为配置
- **快捷键设置**：键盘快捷键自定义
- **高级设置**：高级选项和调试功能

### 2. 具体设置选项

#### 常规设置
- 自动保存功能开关
- 自动保存间隔（1-60分钟）
- 原生菜单栏使用选项
- 最大撤销步数（10-1000）
- 删除前确认选项

#### 语言设置
- 简体中文
- English
- 日本語（基础支持）

#### 主题设置
- 跟随系统主题
- 浅色主题
- 深色主题

#### 编辑器设置
- 网格线显示开关
- 网格对齐功能
- 力度条显示选项
- 默认缩放级别（0.1x - 5.0x）
- 钢琴键宽度（40-120像素）

#### 快捷键设置
- 键盘快捷键总开关
- 可编辑的快捷键列表
- 重置单个或所有快捷键功能

#### 高级设置
- 重置所有设置为默认值

## 技术实现

### 架构设计

设置系统采用MVVM架构模式：

1. **Model层**：
   - `SettingsModel`：设置数据模型
   - `SettingsTypes`：设置相关的类型定义

2. **View层**：
   - `SettingsWindow`：设置窗口界面
   - 使用左侧导航 + 右侧内容的布局

3. **ViewModel层**：
   - `SettingsWindowViewModel`：设置窗口的业务逻辑
   - `MainWindowViewModel`：添加了打开设置的命令

4. **Service层**：
   - `ISettingsService`：设置服务接口
   - `SettingsService`：设置服务实现，负责设置的加载、保存和应用

### 数据持久化

- 设置数据以JSON格式保存在用户数据目录
- 文件位置：`%AppData%/Lumino/settings.json`
- 支持自动保存功能

### 主题系统集成

- 与Avalonia的主题系统深度集成
- 设置更改立即生效
- 支持系统主题跟随

## 使用方法

### 打开设置
1. 在主菜单中点击"文件"
2. 选择"设置"选项
3. 设置窗口将以模态对话框形式打开

### 修改设置
1. 在左侧导航中选择要配置的类别
2. 在右侧区域进行相应的设置修改
3. 修改后会有"未保存更改"提示
4. 点击"保存"按钮保存设置

### 重置设置
- 在"高级设置"页面可以重置所有设置为默认值
- 在"快捷键设置"页面可以重置单个或所有快捷键

## 扩展指南

### 添加新的设置项

1. 在`SettingsModel`中添加新的属性：
```csharp
[ObservableProperty]
private bool _newSetting = false;
```

2. 在`SettingsService`的`LoadSettingsAsync`和`ResetToDefaults`方法中添加对应的处理

3. 在设置窗口的XAML中添加相应的UI控件

### 添加新的设置页面

1. 在`SettingsPageType`枚举中添加新的页面类型
2. 在`SettingsWindowViewModel.InitializePages`方法中添加页面信息
3. 在设置窗口的XAML中添加对应的StackPanel和内容

### 自定义验证

可以在`SettingsModel`中使用数据注解或INotifyDataErrorInfo接口添加设置验证逻辑。

## 注意事项

1. 某些设置（如语言设置）可能需要重启应用程序才能完全生效
2. 设置文件损坏时，系统会自动恢复为默认设置
3. 设置更改会触发自动保存，无需手动保存
4. 模态设置窗口确保用户专注于配置，避免意外操作

## 未来扩展计划

- 导入/导出设置配置
- 多配置文件支持
- 插件设置集成
- 云同步设置功能
- 更多主题选项和自定义主题支持