<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Lumino.ViewModels"
             xmlns:controls="using:Lumino.Views.Controls"
             xmlns:converters="using:Lumino.Views.Converters"
             xmlns:editor="using:Lumino.ViewModels.Editor"
             xmlns:enums="using:Lumino.ViewModels.Editor.Enums"
             mc:Ignorable="d" d:DesignWidth="200" d:DesignHeight="600"
             x:Class="Lumino.Views.Controls.TrackSelector"
             x:DataType="vm:TrackSelectorViewModel">

    <UserControl.Styles>
        <!-- éŸ³è½¨é€‰æ‹©å™¨æ ·å¼ -->
        <Style Selector="Border.TrackSelector">
            <Setter Property="Background" Value="{DynamicResource ToolbarBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ToolbarBorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,1,0"/>
        </Style>

        <!-- æ ‡é¢˜æ æ ·å¼ -->
        <Style Selector="Border.TrackSelectorHeader">
            <Setter Property="Background" Value="{DynamicResource ToolbarBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ToolbarBorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Height" Value="32"/>
        </Style>

        <!-- æ»šåŠ¨æ¡æ ·å¼ -->
        <Style Selector="ScrollViewer">
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <!-- å°æŒ‰é’®æ ·å¼ -->
        <Style Selector="Button.SmallToolButton">
            <Setter Property="Width" Value="20"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ButtonBorderBrush}"/>
            <Setter Property="CornerRadius" Value="2"/>
        </Style>

        <Style Selector="Button.SmallToolButton:pointerover">
            <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ButtonActiveBrush}"/>
        </Style>

        <Style Selector="Button.SmallToolButton:pressed">
            <Setter Property="Background" Value="{DynamicResource ButtonPressedBrush}"/>
        </Style>

        <Style Selector="Button.SmallToolButton.active">
            <Setter Property="Background" Value="{DynamicResource ButtonActiveBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource SliderThumbPressedBrush}"/>
        </Style>
    </UserControl.Styles>

    <UserControl.Resources>
        <!-- æ´‹è‘±çš®ä¸‹æ‹‰èœå• -->
        <MenuFlyout x:Key="OnionSkinFlyout">
            <MenuItem Header="åªæ˜¾ç¤ºä¸Šä¸€ä¸ªéŸ³è½¨ï¼ˆåŠ¨æ€åˆ‡æ¢ï¼‰" 
                      Command="{Binding Toolbar.SelectOnionSkinModeCommand}" 
                      CommandParameter="{x:Static enums:OnionSkinMode.PreviousTrack}"
                      Background="{Binding Toolbar.OnionSkinMode, Converter={x:Static converters:EqualsToBrushConverter.Instance}, ConverterParameter={x:Static enums:OnionSkinMode.PreviousTrack}}"
                      Foreground="{Binding Toolbar.OnionSkinMode, Converter={x:Static converters:EqualsToForegroundConverter.Instance}, ConverterParameter={x:Static enums:OnionSkinMode.PreviousTrack}}"/>
            <MenuItem Header="æ˜¾ç¤ºä¸‹ä¸€ä¸ªéŸ³è½¨ï¼ˆåŠ¨æ€åˆ‡æ¢ï¼‰" 
                      Command="{Binding Toolbar.SelectOnionSkinModeCommand}" 
                      CommandParameter="{x:Static enums:OnionSkinMode.NextTrack}"
                      Background="{Binding Toolbar.OnionSkinMode, Converter={x:Static converters:EqualsToBrushConverter.Instance}, ConverterParameter={x:Static enums:OnionSkinMode.NextTrack}}"
                      Foreground="{Binding Toolbar.OnionSkinMode, Converter={x:Static converters:EqualsToForegroundConverter.Instance}, ConverterParameter={x:Static enums:OnionSkinMode.NextTrack}}"/>
            <MenuItem Header="æ˜¾ç¤ºå…¨éƒ¨éŸ³è½¨" 
                      Command="{Binding Toolbar.SelectOnionSkinModeCommand}" 
                      CommandParameter="{x:Static enums:OnionSkinMode.AllTracks}"
                      Background="{Binding Toolbar.OnionSkinMode, Converter={x:Static converters:EqualsToBrushConverter.Instance}, ConverterParameter={x:Static enums:OnionSkinMode.AllTracks}}"
                      Foreground="{Binding Toolbar.OnionSkinMode, Converter={x:Static converters:EqualsToForegroundConverter.Instance}, ConverterParameter={x:Static enums:OnionSkinMode.AllTracks}}"/>
        </MenuFlyout>
    </UserControl.Resources>

    <Border Classes="TrackSelector">
        <Grid>
            <!-- éŸ³è½¨åˆ—è¡¨å†…å®¹ - åœ¨ PianoRoll å’Œ TrackOverview è§†å›¾ä¸‹æ˜¾ç¤º -->
            <DockPanel IsVisible="{Binding CurrentView, Converter={x:Static converters:IsNotEventListConverter.Instance}}">
                <!-- æ ‡é¢˜æ  -->
                <Border DockPanel.Dock="Top" Classes="TrackSelectorHeader" Height="30">
                    <Grid Margin="8,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Text="éŸ³è½¨åˆ—è¡¨"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource StatusTextBrush}"/>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="2">
                            <!-- æ´‹è‘±çš®æŒ‰é’®ç»„ -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="12"/>
                                </Grid.ColumnDefinitions>

                                <!-- æ´‹è‘±çš®åˆ‡æ¢æŒ‰é’® -->
                                <Button Grid.Column="0" Classes="SmallToolButton" 
                                        Command="{Binding Toolbar.ToggleOnionSkinCommand}" 
                                        ToolTip.Tip="åˆ‡æ¢æ´‹è‘±çš®æ˜¾ç¤º"
                                        Classes.active="{Binding Toolbar.IsOnionSkinEnabled}">
                                    <TextBlock Text="ðŸ‘" FontSize="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Button>

                                <!-- æ´‹è‘±çš®æ¨¡å¼é€‰æ‹©æŒ‰é’® -->
                                <Button Grid.Column="1" Classes="SmallToolButton"
                                        ToolTip.Tip="é€‰æ‹©æ´‹è‘±çš®æ˜¾ç¤ºæ¨¡å¼"
                                        Width="12" Height="20" Margin="0"
                                        Flyout="{StaticResource OnionSkinFlyout}">
                                    <TextBlock Text="â–¼" FontSize="6" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Button>
                            </Grid>

                            <!-- æ·»åŠ éŸ³è½¨æŒ‰é’® -->
                            <Button Classes="SmallToolButton"
                                    Command="{Binding AddTrackCommand}"
                                    ToolTip.Tip="æ·»åŠ éŸ³è½¨">
                                <TextBlock Text="+" FontSize="12" FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Button>
                            <!-- ç»Ÿä¸€çš„è½¨é“è®¾ç½®æŒ‰é’®ï¼šå¼¹çª—ä¸­å¯ä¸‹æ‹‰é€‰æ‹©è¦ç¼–è¾‘çš„éŸ³è½¨ï¼ˆé»˜è®¤å½“å‰é€‰ä¸­ï¼‰ -->
                            <Button Classes="SmallToolButton"
                                    ToolTip.Tip="è½¨é“è®¾ç½®"
                                    Click="OnOpenTrackSettings">
                                <TextBlock Text="âš™" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- éŸ³è½¨åˆ—è¡¨ -->
                <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                              VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding Tracks}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:TrackViewModel">
                                <controls:TrackPanel DataContext="{Binding}"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </DockPanel>

            <!-- äº‹ä»¶åˆ—è¡¨æ¨¡å¼ä¸‹çš„ç©ºç™½å†…å®¹ -->
            <StackPanel IsVisible="{Binding CurrentView, Converter={x:Static converters:ObjectEqualsConverter.Instance}, ConverterParameter={x:Static vm:ViewType.EventList}}"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="ðŸ“‹" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,16"/>
                <TextBlock Text="äº‹ä»¶åˆ—è¡¨" FontSize="20" HorizontalAlignment="Center" Margin="0,0,0,8"
                           Foreground="{DynamicResource StatusTextBrush}"/>
                <TextBlock Text="æ­¤åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…..." FontSize="12" HorizontalAlignment="Center"
                           Foreground="{DynamicResource StatusTextBrush}" Opacity="0.7"/>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>