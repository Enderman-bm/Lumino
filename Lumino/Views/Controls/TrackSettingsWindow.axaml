<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:vm="using:Lumino.ViewModels"
  xmlns:converters="using:Lumino.Views.Converters"
        mc:Ignorable="d"
  x:Class="Lumino.Views.Controls.TrackSettingsWindow"
  SizeToContent="WidthAndHeight"
  MinWidth="380" MinHeight="240"
        Title="轨道设置">

  <Design.DataContext>
    <vm:TrackViewModel />
  </Design.DataContext>

  <StackPanel Margin="12">
    <TextBlock Text="轨道设置" FontSize="16" FontWeight="Bold" Margin="0,0,0,8"/>

    <!-- 统一设置对话框：允许通过下拉选择要编辑的音轨（默认为当前选中） -->
    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
      <TextBlock Text="选择音轨:" Width="80" VerticalAlignment="Center"/>
  <ComboBox x:Name="TrackCombo" Width="360" SelectionChanged="OnTrackSelectionChanged">
      <ComboBox.ItemTemplate>
        <DataTemplate>
          <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
            <Rectangle Width="12" Height="12" Stroke="#777" Fill="{Binding ColorTag, Converter={x:Static converters:HexToBrushConverter.Instance}}" />
            <TextBlock Text="{Binding TrackNumber, StringFormat='{}{0:D2}'}" FontWeight="Bold" Margin="4,0" VerticalAlignment="Center"/>
            <TextBlock Text=" - " VerticalAlignment="Center"/>
            <TextBlock Text="{Binding TrackName}" VerticalAlignment="Center"/>
            <TextBlock Text=" (" Opacity="0.7" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding ChannelName}" Opacity="0.7" VerticalAlignment="Center"/>
            <TextBlock Text=")" Opacity="0.7" VerticalAlignment="Center"/>
          </StackPanel>
        </DataTemplate>
      </ComboBox.ItemTemplate>
    </ComboBox>
    </StackPanel>

    <StackPanel Orientation="Horizontal" Margin="0,4">
      <TextBlock Text="名称:" Width="80" VerticalAlignment="Center"/>
      <TextBox Width="300" Text="{Binding TrackName, Mode=TwoWay}"/>
    </StackPanel>

    <StackPanel Orientation="Horizontal" Margin="0,4">
      <TextBlock Text="MIDI 通道:" Width="80" VerticalAlignment="Center"/>
      <ComboBox x:Name="MidiChannelCombo" Width="120" SelectionChanged="OnMidiChannelChanged"/>
      <TextBlock Text="  索引:" Width="40" Margin="8,0,0,0" VerticalAlignment="Center"/>
      <TextBox Width="60" Text="{Binding ChannelNumberInGroup, Mode=TwoWay}"/>
    </StackPanel>

    <StackPanel Orientation="Horizontal" Margin="0,4">
      <TextBlock Text="乐器:" Width="80" VerticalAlignment="Center"/>
      <ComboBox Width="300" SelectedItem="{Binding Instrument, Mode=TwoWay}">
        <!-- 提供常用乐器作为初始选项，用户可手动输入或扩展列表 -->
        <ComboBoxItem Content="Acoustic Grand Piano"/>
        <ComboBoxItem Content="Bright Acoustic Piano"/>
        <ComboBoxItem Content="Electric Grand Piano"/>
        <ComboBoxItem Content="Honky-tonk Piano"/>
        <ComboBoxItem Content="Electric Piano 1"/>
        <ComboBoxItem Content="Electric Piano 2"/>
        <ComboBoxItem Content="Drawbar Organ"/>
        <ComboBoxItem Content="Percussive Organ"/>
        <ComboBoxItem Content="Synth Strings"/>
        <ComboBoxItem Content="Violin"/>
        <ComboBoxItem Content="String Ensemble"/>
      </ComboBox>
    </StackPanel>

    <StackPanel Orientation="Horizontal" Margin="0,4">
      <TextBlock Text="颜色标签:" Width="80" VerticalAlignment="Center"/>
      <TextBox Width="120" Text="{Binding ColorTag, Mode=TwoWay}"/>
      <Rectangle Width="24" Height="24" Margin="8,0" Fill="{Binding ColorTag, Converter={x:Static converters:HexToBrushConverter.Instance}}" Stroke="#777"/>
      <TextBlock Text="(Hex, e.g. #FF0000)" VerticalAlignment="Center" Margin="8,0" Opacity="0.8"/>
    </StackPanel>

    <StackPanel Orientation="Horizontal" Margin="0,8">
      <TextBlock Text="静音:" Width="80" VerticalAlignment="Center"/>
      <CheckBox IsChecked="{Binding IsMuted, Mode=TwoWay}" Content="静音"/>
      <TextBlock Text="  独奏:" Width="60" VerticalAlignment="Center" Margin="12,0,0,0"/>
      <CheckBox IsChecked="{Binding IsSolo, Mode=TwoWay}" Content="独奏"/>
    </StackPanel>

    <StackPanel Orientation="Horizontal" Margin="0,8">
      <TextBlock Text="Pan:" Width="80" VerticalAlignment="Center"/>
      <Slider Minimum="-1" Maximum="1" Width="200" Value="{Binding Pan, Mode=TwoWay}"/>
      <TextBlock Text="Volume:" Width="60" VerticalAlignment="Center" Margin="12,0,0,0"/>
      <Slider Minimum="0" Maximum="1" Width="120" Value="{Binding Volume, Mode=TwoWay}"/>
    </StackPanel>

    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,18,0,0">
      <Button Width="80" Margin="6,0" Click="OnCancel">取消</Button>
      <Button Width="80" Margin="6,0" Click="OnOk">保存</Button>
    </StackPanel>
  </StackPanel>

</Window>
