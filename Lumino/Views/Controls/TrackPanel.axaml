<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Lumino.ViewModels"
             mc:Ignorable="d" d:DesignWidth="200" d:DesignHeight="60"
             x:Class="Lumino.Views.Controls.TrackPanel"
             x:DataType="vm:TrackViewModel">

    <UserControl.Styles>
        <!-- éŸ³è½¨æŒ‰é’®æ ·å¼ -->
        <Style Selector="Button.TrackButton">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="Margin" Value="1"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="3"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- é™éŸ³æŒ‰é’®æ ·å¼ -->
        <Style Selector="Button.TrackButton.Mute">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ButtonBorderBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource StatusTextBrush}"/>
        </Style>

        <Style Selector="Button.TrackButton.Mute:pointerover">
            <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
        </Style>

        <Style Selector="Button.TrackButton.Mute.active">
            <Setter Property="Background" Value="#FFD700"/>
            <Setter Property="BorderBrush" Value="#FFB000"/>
            <Setter Property="Foreground" Value="Black"/>
        </Style>

        <!-- é™éŸ³æŒ‰é’®æ¿€æ´»çŠ¶æ€ä¸‹çš„é¼ æ ‡æ‚¬åœæ•ˆæžœ -->
        <Style Selector="Button.TrackButton.Mute.active:pointerover">
            <Setter Property="Background" Value="#E6C200"/>
            <Setter Property="BorderBrush" Value="#CC9900"/>
            <Setter Property="Foreground" Value="Black"/>
        </Style>

        <!-- ç‹¬å¥æŒ‰é’®æ ·å¼ -->
        <Style Selector="Button.TrackButton.Solo">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ButtonBorderBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource StatusTextBrush}"/>
        </Style>

        <Style Selector="Button.TrackButton.Solo:pointerover">
            <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
        </Style>

        <Style Selector="Button.TrackButton.Solo.active">
            <Setter Property="Background" Value="#FF4444"/>
            <Setter Property="BorderBrush" Value="#CC0000"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- ç‹¬å¥æŒ‰é’®æ¿€æ´»çŠ¶æ€ä¸‹çš„é¼ æ ‡æ‚¬åœæ•ˆæžœ -->
        <Style Selector="Button.TrackButton.Solo.active:pointerover">
            <Setter Property="Background" Value="#E63333"/>
            <Setter Property="BorderBrush" Value="#AA0000"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- æ´‹è‘±çš®æŒ‰é’®æ ·å¼ -->
        <Style Selector="Button.TrackButton.OnionSkin">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ButtonBorderBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource StatusTextBrush}"/>
        </Style>

        <Style Selector="Button.TrackButton.OnionSkin:pointerover">
            <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
        </Style>

        <Style Selector="Button.TrackButton.OnionSkin.active">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="BorderBrush" Value="#388E3C"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- æ´‹è‘±çš®æŒ‰é’®æ¿€æ´»çŠ¶æ€ä¸‹çš„é¼ æ ‡æ‚¬åœæ•ˆæžœ -->
        <Style Selector="Button.TrackButton.OnionSkin.active:pointerover">
            <Setter Property="Background" Value="#45A049"/>
            <Setter Property="BorderBrush" Value="#2E7D32"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- éŸ³è½¨é¢æ¿æ ·å¼ -->
        <Style Selector="Border.TrackPanel">
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource ToolbarBorderBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <Style Selector="Border.TrackPanel.selected">
            <Setter Property="Background" Value="{DynamicResource ButtonActiveBrush}"/>
        </Style>

        <Style Selector="Border.TrackPanel:pointerover">
            <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
        </Style>

        <Style Selector="Border.TrackPanel.selected:pointerover">
            <Setter Property="Background" Value="{DynamicResource ButtonActiveBrush}"/>
        </Style>

        <!-- Conductorè½¨ç‰¹æ®Šæ ·å¼ -->
        <Style Selector="Border.TrackPanel.conductor">
            <Setter Property="Background" Value="#FFF8DC"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
        </Style>

        <Style Selector="Border.TrackPanel.conductor.selected">
            <Setter Property="Background" Value="#F0E68C"/>
        </Style>

        <Style Selector="Border.TrackPanel.conductor:pointerover">
            <Setter Property="Background" Value="#F5F5DC"/>
        </Style>

        <Style Selector="Border.TrackPanel.conductor.selected:pointerover">
            <Setter Property="Background" Value="#F0E68C"/>
        </Style>

        <!-- å¯ç¼–è¾‘æ–‡æœ¬æ¡†æ ·å¼ -->
        <Style Selector="TextBox.TrackName">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style Selector="TextBox.TrackName:focus">
            <Setter Property="Background" Value="{DynamicResource TextControlBackground}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource TextControlBorderBrush}"/>
        </Style>

        <!-- Conductorè½¨åç§°æ ·å¼ï¼ˆåªè¯»ï¼‰ -->
        <Style Selector="TextBlock.ConductorTrackName">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="#8B4513"/>
        </Style>
    </UserControl.Styles>

    <Border Classes="TrackPanel" 
            Classes.selected="{Binding IsSelected}"
            Classes.conductor="{Binding IsConductorTrack}"
            Height="60"
            x:Name="TrackBorder">
        
        <Grid Margin="6,4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="40"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- éŸ³è½¨å· -->
            <TextBlock Grid.Column="0" Grid.Row="0" 
                       Text="{Binding TrackNumber, StringFormat='{}{0:D2}'}"
                       FontSize="12" FontWeight="Bold"
                       HorizontalAlignment="Center"
                       Foreground="{DynamicResource StatusTextBrush}"/>

            <!-- é€šé“å -->
            <TextBlock Grid.Column="0" Grid.Row="1"
                       Text="{Binding ChannelName}"
                       FontSize="10"
                       HorizontalAlignment="Center"
                       Foreground="{DynamicResource StatusTextBrush}"
                       Opacity="0.8"/>

            <!-- éŸ³è½¨åç§° - æ ¹æ®æ˜¯å¦ä¸ºConductorè½¨é€‰æ‹©ä¸åŒçš„æŽ§ä»¶ -->
            <!-- æ™®é€šéŸ³è½¨ä½¿ç”¨å¯ç¼–è¾‘TextBox -->
            <TextBox Grid.Column="1" Grid.Row="0" Grid.RowSpan="2"
                     Classes="TrackName"
                     Text="{Binding TrackName}"
                     Margin="8,0,4,0"
                     IsVisible="{Binding !IsConductorTrack}"/>

            <!-- Conductorè½¨ä½¿ç”¨åªè¯»TextBlock -->
            <TextBlock Grid.Column="1" Grid.Row="0" Grid.RowSpan="2"
                       Classes="ConductorTrackName"
                       Text="{Binding TrackName}"
                       Margin="8,0,4,0"
                       IsVisible="{Binding IsConductorTrack}"/>

            <!-- æŽ§åˆ¶æŒ‰é’® - åªåœ¨éžConductorè½¨æ˜¾ç¤º -->
            <StackPanel Grid.Column="2" Grid.Row="0" Grid.RowSpan="2"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        IsVisible="{Binding !IsConductorTrack}">
                
                <!-- æ´‹è‘±çš®æŒ‰é’® -->
                <Button Classes="TrackButton OnionSkin"
                        Classes.active="{Binding IsOnionSkinEnabled}"
                        Command="{Binding ToggleOnionSkinCommand}"
                        ToolTip.Tip="æ´‹è‘±çš®æ˜¾ç¤º"
                        PointerPressed="OnOnionSkinButtonPointerPressed"
                        Tapped="OnOnionSkinButtonTapped">
                    <TextBlock Text="ðŸ‘" FontSize="10"/>
                </Button>
                
                <!-- é™éŸ³æŒ‰é’® -->
                <Button Classes="TrackButton Mute"
                        Classes.active="{Binding IsMuted}"
                        Command="{Binding ToggleMuteCommand}"
                        ToolTip.Tip="é™éŸ³ (Mute)"
                        PointerPressed="OnMuteButtonPointerPressed"
                        Tapped="OnMuteButtonTapped">
                    <TextBlock Text="M"/>
                </Button>

                <!-- ç‹¬å¥æŒ‰é’® -->
                <Button Classes="TrackButton Solo"
                        Classes.active="{Binding IsSolo}"
                        Command="{Binding ToggleSoloCommand}"
                        ToolTip.Tip="ç‹¬å¥ (Solo)"
                        PointerPressed="OnSoloButtonPointerPressed"
                        Tapped="OnSoloButtonTapped">
                    <TextBlock Text="S"/>
                </Button>
            </StackPanel>

            <!-- Conductorè½¨çš„ç‰¹æ®Šæ ‡è¯† -->
            <TextBlock Grid.Column="2" Grid.Row="0" Grid.RowSpan="2"
                       Text="â™ª"
                       FontSize="16"
                       VerticalAlignment="Center"
                       HorizontalAlignment="Center"
                       Foreground="#8B4513"
                       ToolTip.Tip="Conductorè½¨ï¼ˆé€Ÿåº¦è½¨ï¼‰"
                       IsVisible="{Binding IsConductorTrack}"/>
        </Grid>
    </Border>
</UserControl>