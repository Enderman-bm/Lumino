<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Lumino.ViewModels"
        xmlns:views="using:Lumino.Views"
        xmlns:controls="using:Lumino.Views.Controls"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="using:Lumino.Views.Converters"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="Lumino.Views.MainWindow"
        x:Name="RootWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Lumino - MIDI Editor"
        Width="1200" Height="800"
        MinWidth="800" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        ShowInTaskbar="True"
        CanResize="True">

	<Design.DataContext>
		<vm:MainWindowViewModel/>
	</Design.DataContext>

	<Window.Styles>
		<!-- ç»Ÿä¸€æŒ‰é’®åŸºç¡€æ ·å¼ - åº”ç”¨Material Designè¿‡æ¸¡åŠ¨ç”» -->
		<Style Selector="Button">
			<Setter Property="Transitions">
				<Transitions>
					<BrushTransition Property="Background" Duration="0:0:0.15"/>
					<ThicknessTransition Property="BorderThickness" Duration="0:0:0.15"/>
				</Transitions>
			</Setter>
		</Style>

		<!-- è§†å›¾é€‰æ‹©æŒ‰é’®æ ·å¼ - Material Designé£Žæ ¼ -->
		<Style Selector="Button.ViewButton">
			<Setter Property="Width" Value="32"/>
			<Setter Property="Height" Value="32"/>
			<Setter Property="Margin" Value="2"/>
			<Setter Property="Padding" Value="6"/>
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="CornerRadius" Value="16"/>
			<Setter Property="HorizontalContentAlignment" Value="Center"/>
			<Setter Property="VerticalContentAlignment" Value="Center"/>
		</Style>

		<!-- æ‚¬åœæ—¶æ˜¾ç¤ºé«˜äº®æ¶Ÿæ¼ª -->
		<Style Selector="Button.ViewButton:pointerover">
			<Setter Property="Background" Value="#1A673AB7"/>
		</Style>

		<!-- æŒ‰ä¸‹æ—¶å¢žå¼ºæ¶Ÿæ¼ª + ç¼©æ”¾ -->
		<Style Selector="Button.ViewButton:pressed">
			<Setter Property="Background" Value="#30673AB7"/>
			<Setter Property="RenderTransform" Value="scale(0.94)"/>
		</Style>

		<!-- æ´»è·ƒçŠ¶æ€ï¼ˆé€‰ä¸­è§†å›¾ï¼‰ -->
		<Style Selector="Button.ViewButton.active">
			<Setter Property="Background" Value="#15673AB7"/>
		</Style>

		<Style Selector="Button.ViewButton TextBlock">
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="HorizontalAlignment" Value="Center"/>
			<Setter Property="VerticalAlignment" Value="Center"/>
		</Style>
	</Window.Styles>

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<!-- ä¸»èœå• -->
		<Menu Grid.Row="0">
			<MenuItem Header="æ–‡ä»¶">
				<MenuItem Header="æ–°å»º" Command="{Binding NewFileCommand}"/>
				<MenuItem Header="æ‰“å¼€" Command="{Binding OpenFileCommand}"/>
				<MenuItem Header="ä¿å­˜" Command="{Binding SaveFileCommand}"/>
				<MenuItem Header="å…³é—­" Command="{Binding CloseFileCommand}"/>
				<Separator/>
				<MenuItem Header="å¯¼å…¥MIDI" Command="{Binding ImportMidiFileCommand}"/>
				<Separator/>
				<MenuItem Header="è®¾ç½®" Command="{Binding OpenSettingsCommand}"/>
				<Separator/>
				<MenuItem Header="é€€å‡º" Command="{Binding ExitApplicationCommand}"/>
			</MenuItem>
			<MenuItem Header="ç¼–è¾‘">
				<MenuItem Header="å…¨é€‰" Command="{Binding SelectAllCommand}"/>
				<MenuItem Header="å–æ¶ˆé€‰æ‹©" Command="{Binding DeselectAllCommand}"/>
			</MenuItem>
			<MenuItem Header="è§†å›¾">
				<MenuItem Header="æ”¾å¤§" Command="{Binding ZoomInCommand}" IsEnabled="{Binding CanZoomIn}"/>
				<MenuItem Header="ç¼©å°" Command="{Binding ZoomOutCommand}" IsEnabled="{Binding CanZoomOut}"/>
				<Separator/>
				<MenuItem Header="é€‚åº”çª—å£" Command="{Binding FitToWindowCommand}"/>
				<MenuItem Header="é‡ç½®ç¼©æ”¾" Command="{Binding ResetZoomCommand}"/>
			</MenuItem>
		</Menu>

		<!-- ä¸»å·¥ä½œåŒº -->
		<DockPanel Grid.Row="1">
			<!-- è§†å›¾é€‰æ‹©é¢æ¿ (å·¦ä¾§) -->
			<Border DockPanel.Dock="Left"
                    Width="48"
                    Background="{DynamicResource ToolbarBackgroundBrush}"
                    BorderBrush="{DynamicResource ToolbarBorderBrush}"
                    BorderThickness="0,0,1,0">
				<StackPanel Margin="6 8 6 8" VerticalAlignment="Top">
					<!-- é’¢ç´å·å¸˜è§†å›¾æŒ‰é’® -->
					<Button Classes="ViewButton"
							Classes.active="{Binding CurrentView, Converter={x:Static converters:ObjectEqualsConverter.Instance}, ConverterParameter={x:Static vm:ViewType.PianoRoll}}"
							Command="{Binding SelectViewCommand}"
							CommandParameter="{x:Static vm:ViewType.PianoRoll}"
							ToolTip.Tip="é’¢ç´å·å¸˜è§†å›¾">
						<TextBlock Text="ðŸŽ¹"/>
					</Button>

					<!-- éŸ³è½¨æ€»è§ˆè§†å›¾æŒ‰é’® -->
					<Button Classes="ViewButton"
							Classes.active="{Binding CurrentView, Converter={x:Static converters:ObjectEqualsConverter.Instance}, ConverterParameter={x:Static vm:ViewType.TrackOverview}}"
							Command="{Binding SelectViewCommand}"
							CommandParameter="{x:Static vm:ViewType.TrackOverview}"
							ToolTip.Tip="éŸ³è½¨æ€»è§ˆ"
							IsEnabled="True">
						<TextBlock Text="ðŸ“Š"/>
					</Button>

					<!-- äº‹ä»¶åˆ—è¡¨è§†å›¾æŒ‰é’® -->
					<Button Classes="ViewButton"
					        Classes.active="{Binding CurrentView, Converter={x:Static converters:ObjectEqualsConverter.Instance}, ConverterParameter={x:Static vm:ViewType.EventList}}"
					        Command="{Binding SelectViewCommand}"
					        CommandParameter="{x:Static vm:ViewType.EventList}"
					        ToolTip.Tip="äº‹ä»¶åˆ—è¡¨"
					        IsEnabled="True">
					    <TextBlock Text="ðŸ“‹"/>
					</Button>

					<!-- éŸ³é¢‘åˆ†æžè§†å›¾æŒ‰é’® -->
					<Button Classes="ViewButton"
					        Classes.active="{Binding CurrentView, Converter={x:Static converters:ObjectEqualsConverter.Instance}, ConverterParameter={x:Static vm:ViewType.AudioAnalysis}}"
					        Command="{Binding SelectViewCommand}"
					        CommandParameter="{x:Static vm:ViewType.AudioAnalysis}"
					        ToolTip.Tip="éŸ³é¢‘åˆ†æž"
					        IsEnabled="True">
					    <TextBlock Text="ðŸŽµ"/>
					</Button>

					<!-- æ—¥å¿—æŸ¥çœ‹å™¨è§†å›¾æŒ‰é’® -->

	</StackPanel>
</Border>

			<!-- éŸ³è½¨é€‰æ‹©æŽ§ä»¶ -->
			<controls:TrackSelector DockPanel.Dock="Left" 
								Width="200"
								x:Name="TrackSelector"
								DataContext="{Binding TrackSelector}"/>

			<!-- ä¸»å†…å®¹åŒºåŸŸ -->
			<Grid>
				<!-- é’¢ç´å·å¸˜è§†å›¾ -->
				<views:PianoRollView DataContext="{Binding PianoRoll}"
									IsVisible="{Binding #RootWindow.DataContext.CurrentView, Converter={x:Static converters:ObjectEqualsConverter.Instance}, ConverterParameter={x:Static vm:ViewType.PianoRoll}}"/>
				
				<!-- éŸ³è½¨æ€»è§ˆè§†å›¾ -->
				<controls:TrackOverviewView DataContext="{Binding TrackOverview}"
						IsVisible="{Binding #RootWindow.DataContext.CurrentView, Converter={x:Static converters:ObjectEqualsConverter.Instance}, ConverterParameter={x:Static vm:ViewType.TrackOverview}}"/>
				
				<!-- äº‹ä»¶åˆ—è¡¨è§†å›¾ï¼ˆé¢„ç•™ï¼‰ -->
				<Border Background="{DynamicResource MainCanvasBackgroundBrush}"
						IsVisible="{Binding #RootWindow.DataContext.CurrentView, Converter={x:Static converters:ObjectEqualsConverter.Instance}, ConverterParameter={x:Static vm:ViewType.EventList}}">
					<StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
						<TextBlock Text="ðŸ“‹" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,16"/>
						<TextBlock Text="äº‹ä»¶åˆ—è¡¨" FontSize="20" HorizontalAlignment="Center" Margin="0,0,0,8"
								   Foreground="{DynamicResource StatusTextBrush}"/>
						<TextBlock Text="æ­¤åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…..." FontSize="12" HorizontalAlignment="Center"
								   Foreground="{DynamicResource StatusTextBrush}" Opacity="0.7"/>
					</StackPanel>
				</Border>

				<!-- éŸ³é¢‘åˆ†æžè§†å›¾ -->
				<views:AudioAnalysisView DataContext="{Binding AudioAnalysisViewModel}"
										IsVisible="{Binding #RootWindow.DataContext.CurrentView, Converter={x:Static converters:ObjectEqualsConverter.Instance}, ConverterParameter={x:Static vm:ViewType.AudioAnalysis}}"/>
				

			</Grid>
		</DockPanel>
		<!-- çŠ¶æ€æ ï¼šæ˜¾ç¤ºFPSå’Œå¸§å»¶è¿Ÿ -->
		<Border Grid.Row="2" Background="{DynamicResource StatusBarBackgroundBrush}" Padding="8" BorderThickness="1,0,0,0" BorderBrush="{DynamicResource ToolbarBorderBrush}" MinHeight="40">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="200"/>
				</Grid.ColumnDefinitions>
				<StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Spacing="16">
					<!-- FPSæ˜¾ç¤º -->
					<TextBlock Text="{Binding CurrentFps, StringFormat='FPS: {0}'}" VerticalAlignment="Center"/>
					
					<!-- å¸§å»¶è¿Ÿæ˜¾ç¤º -->
					<TextBlock Text="{Binding CurrentFrameDelay, StringFormat='å¸§å»¶è¿Ÿ: {0} ms'}" VerticalAlignment="Center"/>
					
				</StackPanel>
				<!-- FPSæ›²çº¿æ˜¾ç¤º -->
				<Canvas Grid.Column="2" Width="200" Height="30" HorizontalAlignment="Right" VerticalAlignment="Center" Background="Black" Margin="8,0,0,0">
					<Polyline Points="{Binding FpsHistory, Converter={x:Static converters:FpsHistoryToPointsConverter.Instance}}" 
							  Stroke="Green" StrokeThickness="1" Fill="Transparent"/>
				</Canvas>
			</Grid>
		</Border>
	</Grid>
</Window>