<Window xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    x:Class="Lumino.Views.Dialogs.PreloadMidiDialog"
    xmlns:local="using:Lumino.Views.Dialogs"
    xmlns:converters="using:Lumino.Views.Converters"
    x:DataType="local:PreloadMidiDialog"
    Title="é¢„åŠ è½½ MIDI"
    Width="520"
    Height="220"
    WindowStartupLocation="CenterOwner"
    CanResize="False"
    ShowInTaskbar="False"
    Topmost="True">

    <Border Name="RootBorder" CornerRadius="8" Padding="12" Margin="8" Background="{Binding BackgroundBrush}" Opacity="{Binding Opacity}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
                <!-- small icon -->
                <TextBlock Text="ðŸŽµ" FontSize="18" VerticalAlignment="Center"/>
                <TextBlock Text="å‡†å¤‡åŠ è½½ MIDI æ–‡ä»¶" FontSize="18" FontWeight="Bold" Margin="4" />
            </StackPanel>

            <!-- ä¸»å†…å®¹é¢æ¿ï¼ˆæ–‡ä»¶ä¿¡æ¯ï¼‰ -->
            <StackPanel x:Name="ContentPanel" Grid.Row="1" Margin="4" Spacing="8" Opacity="1" IsVisible="{Binding IsStarting, Converter={x:Static converters:NotConverter.Instance}}">
                <TextBlock Text="æ–‡ä»¶ï¼š" FontWeight="SemiBold"/>
                <TextBlock Text="{Binding FileName}" TextTrimming="CharacterEllipsis" FontWeight="SemiBold"/>

                <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,8,0,0">
                    <TextBlock Text="å¤§å°ï¼š" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding FileSizeText}" />
                    <!-- simple loading icon -->
                    <Border Width="16" Height="16" CornerRadius="8" Background="Transparent" HorizontalAlignment="Left" Margin="12,0,0,0">
                        <Rectangle x:Name="LoadingRect" Width="12" Height="12" Fill="{DynamicResource ButtonActiveBrush}">
                            <Rectangle.RenderTransform>
                                <RotateTransform Angle="{Binding RotationAngle}"/>
                            </Rectangle.RenderTransform>
                        </Rectangle>
                    </Border>
                </StackPanel>

                <TextBlock Text="è¯·é€‰æ‹©æŽ¥ä¸‹æ¥çš„æ“ä½œï¼šå–æ¶ˆ â€” ä¸åŠ è½½ï¼›é‡æ–°é€‰æ‹© â€” é€‰æ‹©å…¶ä»–æ–‡ä»¶ï¼›åŠ è½½ â€” å¼€å§‹åŠ è½½å½“å‰æ–‡ä»¶ã€‚" TextWrapping="Wrap" Opacity="0.9"/>
            </StackPanel>

            <!-- å¯åŠ¨è¿›åº¦é¢æ¿ï¼ˆåœ¨æŒ‰ä¸‹åŠ è½½åŽå¯è§ï¼‰ -->
            <StackPanel x:Name="ProgressPanel" Grid.Row="1" Margin="4" Spacing="8" IsVisible="{Binding IsStarting}" HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="å¯åŠ¨ä¸­..." FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Center"/>

                <!-- è¿›åº¦çŽ¯/å ä½ï¼šä¿ç•™åœ†å½¢èƒŒæ™¯å¹¶åœ¨å†…éƒ¨æ”¾ç½®è¿›åº¦æ¡ -->
                <Border Width="160" Height="56" CornerRadius="8" Background="{DynamicResource FlyoutBackgroundBrush}" Opacity="0.95" Padding="8">
                    <StackPanel Orientation="Vertical" Spacing="6" HorizontalAlignment="Stretch" VerticalAlignment="Center">
                        <ProgressBar Minimum="0" Maximum="1" Value="{Binding Progress}" Height="10" HorizontalAlignment="Stretch" />
                        <TextBlock Text="{Binding StatusText}" FontSize="12" Opacity="0.95" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </StackPanel>
            

            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8" Margin="0,12,0,0">
                <Button Content="å–æ¶ˆ" Width="96" Command="{Binding CancelCommand}"/>
                <Button Content="é‡æ–°é€‰æ‹©" Width="110" Command="{Binding ReselectCommand}"/>
                <Button Content="åŠ è½½" Width="96" Command="{Binding LoadCommand}" IsDefault="True"/>
            </StackPanel>
        </Grid>
    </Border>
</Window>
